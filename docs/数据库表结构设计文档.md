# 毕业论文管理系统数据库表结构设计

## 1. 数据库设计概述

本数据库设计基于MySQL 8.0，采用关系型数据库设计模式，用于存储毕业论文管理系统的所有数据。数据库设计遵循第三范式，确保数据的完整性和一致性。

## 2. 核心数据表设计

### 2.1 用户表 (users)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `user_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 用户ID |
| `username` | `VARCHAR(50)` | `UNIQUE NOT NULL` | 用户名（学号/工号） |
| `password` | `VARCHAR(255)` | `NOT NULL` | 密码（BCrypt加密） |
| `name` | `VARCHAR(50)` | `NOT NULL` | 姓名 |
| `role` | `VARCHAR(20)` | `NOT NULL` | 角色（admin/teacher/student） |
| `department` | `VARCHAR(100)` | | 院系 |
| `major` | `VARCHAR(100)` | | 专业 |
| `contact` | `VARCHAR(100)` | | 联系方式 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.2 角色权限表 (roles_permissions)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `role_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 角色ID |
| `role_name` | `VARCHAR(50)` | `UNIQUE NOT NULL` | 角色名称 |
| `permissions` | `JSON` | | 权限列表（JSON格式） |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.3 系统设置表 (system_settings)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `setting_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 设置ID |
| `stage_name` | `VARCHAR(100)` | `UNIQUE NOT NULL` | 阶段名称（如：选题、开题、中期检查、论文提交） |
| `start_time` | `DATETIME` | | 开始时间 - 仅作为通知提醒作用 |
| `end_time` | `DATETIME` | | 截止时间 - 仅作为通知提醒作用，不限制实际操作 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.4 师生互选表 (teacher_student_selection)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `selection_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 互选ID |
| `student_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `status` | `VARCHAR(20)` | `NOT NULL` | 状态（待审核/已接受/已拒绝/已解除） |
| `apply_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 申请时间 |
| `review_time` | `DATETIME` | | 审核时间 |
| `bind_time` | `DATETIME` | | 绑定时间 |
| `unbind_time` | `DATETIME` | | 解除时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.5 选题表 (topic_selections)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `topic_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 选题ID |
| `student_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `topic_name` | `VARCHAR(255)` | `NOT NULL` | 选题名称 |
| `topic_description` | `TEXT` | | 选题描述 |
| `submit_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 提交时间 |
| `review_status` | `VARCHAR(20)` | | 审核状态（通过/不通过） |
| `review_opinion` | `TEXT` | | 审核意见 |
| `review_time` | `DATETIME` | | 审核时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.6 任务书表 (assignment_tasks)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `task_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 任务书ID |
| `topic_id` | `BIGINT` | `NOT NULL REFERENCES topic_selections(topic_id)` | 选题ID |
| `student_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `file_path` | `VARCHAR(255)` | `NOT NULL` | 任务书文件路径 |
| `issue_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 下达时间 |
| `deadline` | `DATETIME` | | 截止时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.7 开题报告表 (proposal_reports)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `report_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 报告ID |
| `topic_id` | `BIGINT` | `NOT NULL REFERENCES topic_selections(topic_id)` | 选题ID |
| `student_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `file_path` | `VARCHAR(255)` | | 文件路径 |
| `submit_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 提交时间 |
| `review_status` | `VARCHAR(20)` | | 审核状态（通过/不通过） |
| `review_opinion` | `TEXT` | | 审核意见 |
| `review_time` | `DATETIME` | | 审核时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.8 中期检查表 (midterm_reports)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `report_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 报告ID |
| `topic_id` | `BIGINT` | `NOT NULL REFERENCES topic_selections(topic_id)` | 选题ID |
| `student_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `file_path` | `VARCHAR(255)` | | 文件路径 |
| `submit_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 提交时间 |
| `review_status` | `VARCHAR(20)` | | 审核状态（通过/不通过） |
| `review_opinion` | `TEXT` | | 审核意见 |
| `review_time` | `DATETIME` | | 审核时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.9 论文表 (papers)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `paper_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 论文ID |
| `topic_id` | `BIGINT` | `NOT NULL REFERENCES topic_selections(topic_id)` | 选题ID |
| `student_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `file_path` | `VARCHAR(255)` | | 文件路径 |
| `submit_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 提交时间 |
| `review_status` | `VARCHAR(20)` | | 审核状态（通过/不通过） |
| `review_opinion` | `TEXT` | | 审核意见 |
| `review_time` | `DATETIME` | | 审核时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.10 文件表 (files)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `file_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 文件ID |
| `related_id` | `BIGINT` | | 关联ID（如选题ID、开题报告ID等） |
| `file_name` | `VARCHAR(255)` | `NOT NULL` | 文件名称 |
| `file_path` | `VARCHAR(255)` | `NOT NULL` | 文件路径 |
| `uploader_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 上传人ID |
| `receiver_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 接收人ID |
| `file_type` | `VARCHAR(50)` | | 文件类型 |
| `version` | `INT` | `DEFAULT 1` | 版本号 |
| `sync_status` | `VARCHAR(20)` | `DEFAULT 'pending'` | 同步状态（pending/synced） |
| `upload_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 上传时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

### 2.11 进度表 (progress)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `progress_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 进度ID |
| `student_id` | `BIGINT` | `UNIQUE NOT NULL REFERENCES users(user_id)` | 学生ID |
| `teacher_id` | `BIGINT` | `NOT NULL REFERENCES users(user_id)` | 教师ID |
| `topic_status` | `VARCHAR(20)` | | 选题状态 |
| `task_status` | `VARCHAR(20)` | | 任务书状态 |
| `proposal_status` | `VARCHAR(20)` | | 开题状态 |
| `midterm_status` | `VARCHAR(20)` | | 中期检查状态 |
| `paper_status` | `VARCHAR(20)` | | 论文状态 |
| `updated_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |

### 2.12 通知表 (notifications)

| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| `notification_id` | `BIGINT` | `PRIMARY KEY AUTO_INCREMENT` | 通知ID |
| `title` | `VARCHAR(255)` | `NOT NULL` | 标题 |
| `content` | `TEXT` | `NOT NULL` | 内容 |
| `publisher_id` | `BIGINT` | `REFERENCES users(user_id)` | 发布人ID |
| `receive_role` | `VARCHAR(20)` | | 接收角色（admin/teacher/student/all） |
| `publish_time` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 发布时间 |
| `created_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP` | 创建时间 |
| `updated_at` | `DATETIME` | `DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP` | 更新时间 |

## 3. 索引设计

### 3.1 唯一索引

| 表名 | 索引字段 | 索引类型 | 描述 |
| :--- | :--- | :--- | :--- |
| `users` | `username` | `UNIQUE` | 确保用户名唯一 |
| `roles_permissions` | `role_name` | `UNIQUE` | 确保角色名称唯一 |
| `system_settings` | `stage_name` | `UNIQUE` | 确保阶段名称唯一 |

### 3.2 普通索引

| 表名 | 索引字段 | 索引类型 | 描述 |
| :--- | :--- | :--- | :--- |
| `users` | `role` | `INDEX` | 按角色查询用户 |
| `users` | `department` | `INDEX` | 按院系查询用户 |
| `users` | `major` | `INDEX` | 按专业查询用户 |
| `teacher_student_selection` | `student_id` | `INDEX` | 按学生查询申请 |
| `teacher_student_selection` | `teacher_id` | `INDEX` | 按教师查询申请 |
| `teacher_student_selection` | `status` | `INDEX` | 按状态查询申请 |
| `topic_selections` | `student_id` | `INDEX` | 按学生查询选题 |
| `topic_selections` | `teacher_id` | `INDEX` | 按教师查询选题 |
| `topic_selections` | `review_status` | `INDEX` | 按审核状态查询选题 |
| `files` | `uploader_id` | `INDEX` | 按上传人查询文件 |
| `files` | `receiver_id` | `INDEX` | 按接收人查询文件 |
| `files` | `sync_status` | `INDEX` | 按同步状态查询文件 |
| `progress` | `student_id` | `INDEX` | 按学生查询进度 |
| `progress` | `teacher_id` | `INDEX` | 按教师查询进度 |

## 4. 外键关系

| 主表 | 主表字段 | 从表 | 从表字段 | 约束 |
| :--- | :--- | :--- | :--- | :--- |
| `users` | `user_id` | `teacher_student_selection` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `teacher_student_selection` | `teacher_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `topic_selections` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `topic_selections` | `teacher_id` | `ON DELETE CASCADE` |
| `topic_selections` | `topic_id` | `assignment_tasks` | `topic_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `assignment_tasks` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `assignment_tasks` | `teacher_id` | `ON DELETE CASCADE` |
| `topic_selections` | `topic_id` | `proposal_reports` | `topic_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `proposal_reports` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `proposal_reports` | `teacher_id` | `ON DELETE CASCADE` |
| `topic_selections` | `topic_id` | `midterm_reports` | `topic_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `midterm_reports` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `midterm_reports` | `teacher_id` | `ON DELETE CASCADE` |
| `topic_selections` | `topic_id` | `papers` | `topic_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `papers` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `papers` | `teacher_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `files` | `uploader_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `files` | `receiver_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `progress` | `student_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `progress` | `teacher_id` | `ON DELETE CASCADE` |
| `users` | `user_id` | `notifications` | `publisher_id` | `ON DELETE SET NULL` |

## 5. 数据库初始化脚本

### 5.1 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS thesis_management;
USE thesis_management;
```

### 5.2 创建表结构

```sql
-- 用户表
CREATE TABLE IF NOT EXISTS users (
    user_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(50) NOT NULL,
    role VARCHAR(20) NOT NULL,
    department VARCHAR(100),
    major VARCHAR(100),
    contact VARCHAR(100),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 角色权限表
CREATE TABLE IF NOT EXISTS roles_permissions (
    role_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(50) UNIQUE NOT NULL,
    permissions JSON,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 系统设置表
CREATE TABLE IF NOT EXISTS system_settings (
    setting_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    stage_name VARCHAR(100) UNIQUE NOT NULL,
    start_time DATETIME,
    end_time DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 师生互选表
CREATE TABLE IF NOT EXISTS teacher_student_selection (
    selection_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    status VARCHAR(20) NOT NULL,
    apply_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    review_time DATETIME,
    bind_time DATETIME,
    unbind_time DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 选题表
CREATE TABLE IF NOT EXISTS topic_selections (
    topic_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    topic_name VARCHAR(255) NOT NULL,
    topic_description TEXT,
    submit_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    review_status VARCHAR(20),
    review_opinion TEXT,
    review_time DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 任务书表
CREATE TABLE IF NOT EXISTS assignment_tasks (
    task_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    topic_id BIGINT NOT NULL,
    student_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    issue_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    deadline DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (topic_id) REFERENCES topic_selections(topic_id) ON DELETE CASCADE,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 开题报告表
CREATE TABLE IF NOT EXISTS proposal_reports (
    report_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    topic_id BIGINT NOT NULL,
    student_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    file_path VARCHAR(255),
    submit_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    review_status VARCHAR(20),
    review_opinion TEXT,
    review_time DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (topic_id) REFERENCES topic_selections(topic_id) ON DELETE CASCADE,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 中期检查表
CREATE TABLE IF NOT EXISTS midterm_reports (
    report_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    topic_id BIGINT NOT NULL,
    student_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    file_path VARCHAR(255),
    submit_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    review_status VARCHAR(20),
    review_opinion TEXT,
    review_time DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (topic_id) REFERENCES topic_selections(topic_id) ON DELETE CASCADE,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 论文表
CREATE TABLE IF NOT EXISTS papers (
    paper_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    topic_id BIGINT NOT NULL,
    student_id BIGINT NOT NULL,
    teacher_id BIGINT NOT NULL,
    file_path VARCHAR(255),
    submit_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    review_status VARCHAR(20),
    review_opinion TEXT,
    review_time DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (topic_id) REFERENCES topic_selections(topic_id) ON DELETE CASCADE,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 文件表
CREATE TABLE IF NOT EXISTS files (
    file_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    related_id BIGINT,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(255) NOT NULL,
    uploader_id BIGINT NOT NULL,
    receiver_id BIGINT NOT NULL,
    file_type VARCHAR(50),
    version INT DEFAULT 1,
    sync_status VARCHAR(20) DEFAULT 'pending',
    upload_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (uploader_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (receiver_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 进度表
CREATE TABLE IF NOT EXISTS progress (
    progress_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    student_id BIGINT UNIQUE NOT NULL,
    teacher_id BIGINT NOT NULL,
    topic_status VARCHAR(20),
    task_status VARCHAR(20),
    proposal_status VARCHAR(20),
    midterm_status VARCHAR(20),
    paper_status VARCHAR(20),
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (teacher_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- 通知表
CREATE TABLE IF NOT EXISTS notifications (
    notification_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    publisher_id BIGINT,
    receive_role VARCHAR(20),
    publish_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (publisher_id) REFERENCES users(user_id) ON DELETE SET NULL
);

-- 创建索引
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_department ON users(department);
CREATE INDEX idx_users_major ON users(major);
CREATE INDEX idx_selection_student ON teacher_student_selection(student_id);
CREATE INDEX idx_selection_teacher ON teacher_student_selection(teacher_id);
CREATE INDEX idx_selection_status ON teacher_student_selection(status);
CREATE INDEX idx_topic_student ON topic_selections(student_id);
CREATE INDEX idx_topic_teacher ON topic_selections(teacher_id);
CREATE INDEX idx_topic_status ON topic_selections(review_status);
CREATE INDEX idx_files_uploader ON files(uploader_id);
CREATE INDEX idx_files_receiver ON files(receiver_id);
CREATE INDEX idx_files_sync ON files(sync_status);
CREATE INDEX idx_progress_student ON progress(student_id);
CREATE INDEX idx_progress_teacher ON progress(teacher_id);
```

### 5.3 初始化数据

```sql
-- 插入管理员账号（密码：admin123）
INSERT INTO users (username, password, name, role) VALUES 
('admin', '$2a$10$eF693pDd0z1L7uX5L6Q2CeuW4x3y5z6A7b8c9d0e1f2g3h4i5j6k7l8m9n0o', '管理员', 'admin');

-- 插入角色权限
INSERT INTO roles_permissions (role_name, permissions) VALUES 
('admin', '{"permissions": ["user:manage", "system:config", "data:backup", "stats:view"]}'),
('teacher', '{"permissions": ["student:manage", "topic:review", "file:upload", "progress:view"]}'),
('student', '{"permissions": ["topic:submit", "file:upload", "progress:view"]}');

-- 插入系统默认阶段设置
INSERT INTO system_settings (stage_name) VALUES 
('选题'),
('开题'),
('中期检查'),
('论文提交');
```

## 6. 数据库优化建议

### 6.1 性能优化

1. **索引优化**：根据查询频率和条件，合理创建索引，避免全表扫描。
2. **分区表**：对于文件表等大表，可以考虑使用分区表，按时间或其他维度分区。
3. **缓存策略**：使用Redis缓存热点数据，如用户会话、权限信息等。
4. **批量操作**：对于批量上传文件等操作，使用批量插入语句，减少数据库连接次数。

### 6.2 安全优化

1. **密码加密**：使用BCrypt对密码进行加密存储，避免明文存储。
2. **SQL注入防护**：使用MyBatis-Plus的参数化查询，避免SQL注入攻击。
3. **权限控制**：在数据库层面也可以设置适当的权限，限制用户对表的操作。
4. **数据备份**：定期进行数据备份，确保数据安全。

### 6.3 可维护性优化

1. **命名规范**：使用统一的命名规范，提高代码可读性。
2. **注释**：为表结构和字段添加适当的注释，便于理解。
3. **版本控制**：对数据库结构变更进行版本控制，记录变更历史。
4. **文档**：维护数据库设计文档，便于后续开发和维护。